/*! flot-legend 1.0.0-SNAPSHOT - built on 2015-10-17 */
!function(a){"use strict";function b(a){return a.legend.style.lineSpacing+Math.max(a.legend.style.badgeSize,a.legend.style.fontSize)}function c(c){var d=b(c),e=0,f=0;return a.each(c.legend.statements,function(a){var b=c.legend.statements[a];b.value.indexOf("\\n")>-1?(e++,f=0):f++}),f>0&&e++,e*d+c.legend.margin.top+c.legend.margin.bottom}function d(a){for(var b=[],c=[],d={},e=/^%(\d*)(\.(\d+))?lf/,f=function(a){d.hasOwnProperty(a)?d[a]+=1:d[a]=1},g=function(a){return d.hasOwnProperty(a)?d[a]:0},h=function(a){b.length>0&&(c.push({type:j.Text,value:b.join("")}),b=[],f(j.Text)),void 0!==a&&(c.push(a),f(a.type))},i=0,k=a.length;k>i;i++){var l,m=a[i],n=a[Math.min(i+1,k-1)];if("%"===m&&"g"===n)h({type:j.Badge}),i++;else if("%"===m&&"s"===n)h({type:j.Unit}),i++;else if("%"===m&&"%"===n)b.push("%"),i++;else if("\\"==m&&"n"==n)h({type:j.Newline}),i++;else if(null!==(l=e.exec(a.slice(i)))){var o=NaN;try{o=parseInt(l[1])}catch(p){}var q=NaN;try{q=parseInt(l[3])}catch(p){}h({type:j.Lf,length:isNaN(o)?null:o,precision:isNaN(q)?null:q}),i+=l[0].length-1}else b.push(m)}return g(j.Badge)>0&&b.push(" "),g(j.Lf)>0&&0===g(j.Unit)&&c[c.length-1].type===j.Lf&&b.push(" "),h(),c}function e(b,c){var d,e,f=b.length,g=0,h=NaN,i=NaN,j=function(a){if(null===a)return NaN;if(2===a.length)return a[1];if(3===a.length)return a[1]-a[2];throw"Unsupported point of length "+a.length};if("MIN"===c)return a.each(b,function(a){e=j(b[a]),isNaN(e)||(isNaN(h)||h>e)&&(h=e)}),h;if("MAX"===c)return a.each(b,function(a){e=j(b[a]),isNaN(e)||(isNaN(i)||e>i)&&(i=e)}),i;if("AVERAGE"===c||"AVG"===c)return f=0,a.each(b,function(a){e=j(b[a]),isNaN(e)||(g+=e,f++)}),f>0?g/f:NaN;if("LAST"===c){for(d=f-1;d>=0;d--)if(e=j(b[d]),!isNaN(e))return e;return NaN}throw"Unsupported aggregation: "+c}function f(c,f,h,i){var k=f.canvasCtx,l=h.legend.style.badgeSize,m=h.legend.style.fontSize,n=void 0;if(void 0!==c.metric&&(a.each(i,function(a){i[a].metric===c.metric&&(n=i[a])}),void 0!==h.hiddenSeries&&a.each(h.hiddenSeries,function(a){h.hiddenSeries[a].metric===c.metric&&(n=h.hiddenSeries[a])}),void 0===n))throw"No series with metric '"+c.metric+"' was found.";var o="",p=d(c.value);a.each(p,function(a){var d=p[a];if(d.type===j.Text)g(f,m,d.value);else if(d.type===j.Badge)k.fillStyle=n.color,k.fillRect(f.x,f.y,l,l),k.beginPath(),k.lineWidth="0.5",k.strokeStyle="black",k.rect(f.x,f.y,l,l),k.stroke(),f.x+=l;else if(d.type===j.Newline)f.y+=b(h),f.x=f.xMin;else if(d.type===j.Unit)""===o&&(o=" "),g(f,m,o+" ");else{if(d.type!==j.Lf)throw"Unsupported token: "+JSON.stringify(d);var i=e(n.data,c.aggregation),q=i;if(o="",!isNaN(i)){var r=d3.formatPrefix(i,d.precision);o=r.symbol,q=r.scale(i)}var s="";isNaN(d.length)||(s+=d.length),isNaN(d.precision)||(s+="."+d.precision),s+="f",s=d3.format(s),g(f,m,s(q))}})}function g(a,b,c){var d=a.canvasCtx;d.fillStyle="black",d.font=b+"px Monospace",d.textAlign="left",d.fillText(c,a.x,a.y+b);var e=d.measureText(c);a.x+=e.width}function h(b){b.hooks.processOptions.push(function(b,d){if(!(d.legend.statements.length<1)){d.legend.show=!1;var e=c(d);d.grid.margin.bottom+=e,b.hooks.draw.push(function(b){var c={};c.canvasCtx=b.getCanvas().getContext("2d"),c.xMin=d.legend.margin.left,c.yMin=c.canvasCtx.canvas.clientHeight-e+d.legend.margin.top,c.xMax=c.canvasCtx.canvas.clientWidth-d.legend.margin.right,c.yMax=c.canvasCtx.canvas.clientHeight-d.legend.margin.bottom,c.x=c.xMin,c.y=c.yMin;var g=b.getData();a.each(d.legend.statements,function(a){var b=d.legend.statements[a];f(b,c,d,g)}),c.canvasCtx.save()})}})}var i={legend:{statements:[],margin:{left:5,right:0,top:0,bottom:0},style:{fontSize:10,badgeSize:10,lineSpacing:5}}},j=Object.freeze({Badge:"badge",Text:"text",Unit:"unit",Lf:"lf",Newline:"newline"});a.plot.plugins.push({init:h,options:i,name:"legend",version:"1.0.0"})}(jQuery);