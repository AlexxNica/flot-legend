/*! flot-legend 1.0.0-SNAPSHOT - built on 2015-10-16 */
!function(a){function b(a){return a.legend.style.lineSpacing+Math.max(a.legend.style.badgeSize,a.legend.style.fontSize)}function c(c){var d=b(c),e=0,f=0;return a.each(c.legend.statements,function(a){var b=c.legend.statements[a];b.value.indexOf("\\n")>-1?(e++,f=0):f++}),f>0&&e++,e*d+c.legend.margin.top+c.legend.margin.bottom}function d(a){for(var b=!1,c=!1,d=!1,e=[],f=[],g=0,h=a.value.length;h>g;g++){var i=Math.min(g+1,h-1),j=a.value[g],k=a.value[i];if("%"===j&&"g"===k)e.length>0&&(f.push({type:"text",value:e.join("")}),e=[]),f.push({type:"badge"}),b=!0,g++;else if("%"===j&&"s"===k)e.length>0&&(f.push({type:"text",value:e.join("")}),e=[]),f.push({type:"unit"}),d=!0,g++;else if("%"===j&&"%"===k)e.push("%"),g++;else if("\\"==j&&"n"==k)e.length>0&&(f.push({type:"text",value:e.join("")}),e=[]),f.push({type:"newline"}),g++;else if(null!==a.value.slice(g).match(/^%(\d*)\.\d+lf/)){var l=a.value.slice(g),m=/^%(\d*)\.(\d+)lf/,n=m.exec(l),o=n[1],p=n[2];e.length>0&&(f.push({type:"text",value:e.join("")}),e=[]),f.push({type:"lf",length:null!==o?parseInt(o):-1,precision:parseInt(p)}),c=!0,g+=n[0].length-1}else e.push(j)}return b&&e.push(" "),c&&!d&&"lf"===f[f.length-1].type&&e.push(" "),e.length>0&&f.push({type:"text",value:e.join("")}),f}function e(a,b,c){var d=a.canvasCtx;d.fillStyle="black",d.font=b+"px Monospace",d.textAlign="left",d.fillText(c,a.x,a.y+b);var e=d.measureText(c);a.x+=e.width}function f(b,c){var d,e=c.data.length,f=0,g=NaN,h=NaN,i=NaN,j=function(a){if(2===a.length)return a[1];if(3===a.length)return a[1]-a[2];throw"Unsupported point of length "+a.length};if("MIN"===b)return a.each(c.data,function(a){d=j(c.data[a]),isNaN(d)||(isNaN(g)||g>d)&&(g=d)}),g;if("MAX"===b)return a.each(c.data,function(a){d=j(c.data[a]),isNaN(d)||(isNaN(h)||d>h)&&(h=d)}),h;if("AVERAGE"===b||"AVG"===b)return e=0,a.each(c.data,function(a){d=j(c.data[a]),isNaN(d)||(f+=d,e++)}),e>0?f/e:NaN;if("LAST"===b)return a.each(c.data,function(a){d=j(c.data[a]),isNaN(d)||(i=d)}),i;throw"Unsupported aggregation: "+b}function g(c,g,h,i){var j=g.canvasCtx,k=(h.legend.style.spaceWidth,h.legend.style.badgeSize),l=h.legend.style.fontSize,m=void 0;if(void 0!==c.metric&&(a.each(i,function(a){i[a].metric===c.metric&&(m=i[a])}),a.each(h.hiddenSeries,function(a){h.hiddenSeries[a].metric===c.metric&&(m=h.hiddenSeries[a])}),void 0===m))throw"No series with metric '"+c.metric+"' was found.";var n="",o=d(c);a.each(o,function(a){var d=o[a];if("text"===d.type)e(g,l,d.value);else if("badge"===d.type)j.fillStyle=m.color,j.fillRect(g.x,g.y,k,k),j.beginPath(),j.lineWidth="0.5",j.strokeStyle="black",j.rect(g.x,g.y,k,k),j.stroke(),g.x+=k;else if("newline"===d.type)g.y+=b(h),g.x=g.xMin;else if("unit"===d.type)""===n&&(n=" "),e(g,l,n+" ");else{if("lf"!==d.type)throw"Unsupported token: "+JSON.stringify(d);var i=f(c.aggregation,m),p=i;if(n="",!isNaN(i)){var q=d3.formatPrefix(i,d.precision);n=q.symbol,p=q.scale(i)}var r="";isNaN(d.length)||(r+=d.length),isNaN(d.precision)||(r+="."+d.precision),r+="f",r=d3.format(r),e(g,l,r(p))}})}function h(b){b.hooks.processOptions.push(function(b,d){if(!(d.legend.statements.length<1)){d.legend.show=!1;var e=c(d);d.grid.margin.bottom+=e,b.hooks.draw.push(function(b){var c={};c.canvasCtx=b.getCanvas().getContext("2d"),c.xMin=d.legend.margin.left,c.yMin=c.canvasCtx.canvas.clientHeight-e+d.legend.margin.top,c.xMax=c.canvasCtx.canvas.clientWidth-d.legend.margin.right,c.yMax=c.canvasCtx.canvas.clientHeight-d.legend.margin.bottom,c.x=c.xMin,c.y=c.yMin;var f=b.getData();a.each(d.legend.statements,function(a){var b=d.legend.statements[a];g(b,c,d,f)}),c.canvasCtx.save()})}})}var i={legend:{statements:[],margin:{left:5,right:0,top:0,bottom:0},style:{fontSize:10,spaceWidth:5,badgeSize:10,lineSpacing:5}}};a.plot.plugins.push({init:h,options:i,name:"legend",version:"1.0.0"})}(jQuery);